<template>
    <div class="searchitem">
        <app-head></app-head>
     
        <div id="product_list" class="list">
    <ul class="goods-secrch-list" 
         v-infinite-scroll="loadMore"
        infinite-scroll-disabled="loading"
        infinite-scroll-distance="10"
        >
			<app-food v-for="food in foods" :key="food.goods_id" :food="food"></app-food>
			
			<!--<li class="loading"><div class="spinner"><i></i></div>商品数据读取中...</li>-->
			
	</ul>
  </div>
  <back-top></back-top>
    </div>

</template>
<script>
import { Toast } from 'mint-ui';
import bus from '../../../modules/bus'
import axios from 'axios'
import AppHead from './SearchHead.vue'
import AppFood from './Searchsome.vue'
import {mapState} from 'vuex'
import { InfiniteScroll } from 'mint-ui'
import BackTop from '../backTop/backTop'

// http://www.hangowa.com/mo_bile/index.php?act=goods&op=goods_list&keyword=%E8%8B%B9%E6%9E%9C&page=10&curpage=1&keyword=%E8%8B%B9%E6%9E%9C
export default {
    name:"searchitem",
    data(){
        return{
            //  mmm:"",
             foods:[],
             curpage:1,
             page:10,
             loading:false,
             hashMore:true,
             keyword:this.mmm,
             goodmsg:''
        }
      
    },
    components:{
        AppHead,AppFood,BackTop
    },
    computed:{
        ...mapState({
				mmm:state=>state.search.message,
                serC:state=>state.search.serBox,
			})
    },
    methods:{
         getGoods(qqq){
          if(!this.hashMore){
              //提示：没有更多数据了
              Toast({
                message: '没有更多数据了',
                position: 'bottom',
                duration: 1500
              });
              return ;
          }
          //提示：请稍等...
            let toast = Toast({
                message: '正在加载...',
                iconClass: 'fa fa-spinner fa-pulse',
                duration:-1
            });
          this.loading = true
          let {page,curpage,keyword} = this
                // console.log()
				axios.get(this.$root.config.host+'it/mo_bile/index.php?act=goods&op=goods_list&keyword='+qqq+'&page='+this.page+'&curpage='+curpage+'&keyword='+qqq
                   
            ).then(res=>{
                     toast.close()
                    console.log(res)
                    // this.foods = res.data.datas.goods_list
                    this.foods = this.foods.concat(res.data.datas.goods_list)
                    console.log(this.foods)
                     this.hashMore = Boolean(res.hasmore)
                     console.log(res.data.hasmore)
                    this.curpage++
                    this.loading=false
					// this.goods = res.data.datas.list.slice(1,4)
					console.log(this.curpage)
				})
			},
            loadMore () {
                console.log(this.mmm)
                  if(!this.mmm){
                        this.getGoods(this.$route.params.idd)
                        return;
                    }
                 this.getGoods(this.mmm)
            },
          
	},

        

}
</script>
<style lang="scss" scoped>
 button{

                    margin-top: 20em;
                }
        .goods-secrch-list {
                display: block;
                margin-top: 50px;
               
            }
</style>
